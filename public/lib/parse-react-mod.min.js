/*
 *  Parse + React
 *  v0.5.0 - MODIFIED BY NEIL on 12/31/2015 to apply patch from
 * GitHub Issue: https://github.com/ParsePlatform/ParseReact/issues/37
 *
 *  Copyright (c) 2015, Parse, LLC. All rights reserved.
 *
 *  You are hereby granted a non-exclusive, worldwide, royalty-free license to
 *  use, copy, modify, and distribute this software in source code or binary
 *  form for use in connection with the web services and APIs provided by Parse.
 *
 *  As with any software that integrates with the Parse platform, your use of
 *  this software is subject to the Parse Terms of Service
 *  [https://www.parse.com/about/terms]. This copyright notice shall be
 *  included in all copies or substantial portions of the software.
 *
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 *  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 *  IN THE SOFTWARE.
 *
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.ParseReact=e()}}(function(){return function e(t,r,n){function i(a,o){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[a]={exports:{}};t[a][0].call(f.exports,function(e){var r=t[a][1][e];return i(r?r:e)},f,f.exports,e,t,r,n)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t){"use strict";var r=e("./LocalSubscriptions"),n=e("./ParsePatches");n.applyPatches(),t.exports={Component:e("./ParseComponent"),currentUser:r.currentUser,Mixin:e("./Mixin"),Mutation:e("./Mutation")}},{"./LocalSubscriptions":5,"./Mixin":6,"./Mutation":7,"./ParseComponent":11,"./ParsePatches":12}],2:[function(){},{}],3:[function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=e("./Id"),s=function(){function e(t,n,s){if(r(this,e),!(t instanceof i))throw new TypeError("Cannot create a Delta with an invalid target Id");if(this.id=t,s&&s.destroy)this.map={},this.destroy=!0;else{this.map={};for(var a in n)"objectId"!==a&&(this.map[a]=n[a])}}return n(e,[{key:"merge",value:function(t){if(!(t instanceof e))throw new TypeError("Only Deltas can be merged");if(this.id.toString()!==t.id.toString())throw new Error("Only Deltas for the same Object can be merged");if(t.destroy&&(this.map={},this.destroy=!0),!this.destroy)for(var r in t.map)this.map[r]=t.map[r]}}]),e}();t.exports=s},{"./Id":4}],4:[function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t,n){r(this,e),this.className=t,this.objectId=n}return n(e,[{key:"toString",value:function(){return this.className+":"+this.objectId}}],[{key:"fromString",value:function(t){var r=t.split(":");if(2!==r.length)throw new TypeError("Cannot create Id object from this string");return new e(r[0],r[1])}}]),e}();t.exports=i},{}],5:[function(e,t){"use strict";var r=e("./flatten"),n=e("./Id"),i=e("./ObjectStore"),s=e("./StubParse"),a={subscribers:{},observerCount:0,subscribe:function(e){var t=this,a="o"+this.observerCount++;this.subscribers[a]=e;var o,u=null;try{u=s.User.current()}catch(c){}return u?(o=new n("_User",s.User.current().id),i.getLatest(o)||i.storeObject(r(s.User.current())),e.onNext(i.getLatest(o))):s.Storage.async()&&(s.User.currentAsync().then(function(t){null!==t?(o=new n("_User",t.id),i.getLatest(o)||i.storeObject(r(t)),e.onNext(i.getLatest(o))):e.onNext(null)}),e.onNext(void 0)),{dispose:function(){delete t.subscribers[a]}}},update:function(e){var t=this;s.User.currentAsync().then(function(a){if(null!==a){for(var o in e)"id"!==o&&"objectId"!==o&&"className"!==o&&"sessionToken"!==o&&"createdAt"!==o&&"updatedAt"!==o&&a.set(o,e[o]);s.CoreManager.getUserController().setCurrentUser(a)}for(var u in t.subscribers){var c=null;a&&(c=i.getLatest(new n("_User",a.id)),null===c&&(c=r(a),i.storeObject(c))),t.subscribers[u].onNext(c)}})}},o={currentUser:a};t.exports=o},{"./Id":4,"./ObjectStore":10,"./StubParse":14,"./flatten":19}],6:[function(e,t){"use strict";var r=e("./StubParse"),n=e("./warning"),i={componentWillMount:function(){if(this._subscriptions={},this.data=this.data||{},this._pendingQueries={},this._queryErrors={},!this.observe)throw new Error("Components using ParseReact.Mixin must declare an observe() method.");this._subscribe(this.props,this.state)},componentWillUnmount:function(){this._unsubscribe()},componentWillUpdate:function(e,t){(e!==this.props||t!==this.state)&&this._subscribe(e,t)},pendingQueries:function(){var e=[];for(var t in this._subscriptions)this._subscriptions[t].pending&&this._subscriptions[t].pending()&&e.push(t);return e},queryErrors:function(){if(Object.keys(this._queryErrors).length<1)return null;var e={};for(var t in this._queryErrors)e[t]=this._queryErrors[t];return e},refreshQueries:function(e){var t,r={};if("undefined"==typeof e)for(t in this._subscriptions)r[t]=this._subscriptions[t];else if("string"==typeof e)this._subscriptions[e]?r[e]=this._subscriptions[e]:n("Cannot refresh unknown query name: "+e);else{if(!Array.isArray(e))throw new TypeError("refreshQueries must receive a query name or an array of query names");for(var i=0;i<e.length;i++)this._subscriptions[e[i]]?r[e[i]]=this._subscriptions[e[i]]:n("Cannot refresh unknown query name: "+e[i])}for(t in r)this._pendingQueries[t]=!0,r[t].refresh();this.forceUpdate()},_subscribe:function(e,t){var i=this.observe(e,t),s={};for(var a in i)i[a].subscribe?(s[a]=i[a].subscribe({onNext:this._receiveData.bind(this,a),onError:i[a]instanceof r.Query?this._receiveError.bind(this,a):function(){}}),this._pendingQueries[a]=!0):n('The observation value "'+a+'" is not subscribable. Make sure you are returning the Query, and not fetching it yourself.');this._unsubscribe(),this._subscriptions=s},_unsubscribe:function(){for(var e in this._subscriptions)this._subscriptions[e].dispose();this._subscriptions={}},_receiveData:function(e,t){this.data[e]=t,delete this._pendingQueries[e],delete this._queryErrors[e],this.forceUpdate()},_receiveError:function(e,t){this._queryErrors[e]=t,this.forceUpdate()}};t.exports=i},{"./StubParse":14,"./warning":20}],7:[function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){if(e instanceof u)return e;if(e.className&&e.objectId)return new u(e.className,e.objectId);throw new TypeError("Argument must be a plain Parse Object with a className and objectId")}function i(e){if(!e||"string"!=typeof e||"objectId"===e||"createdAt"===e||"updatedAt"===e)throw new TypeError("Invalid column name for mutation: "+e)}function s(e){var t=0;for(var r in e)if(e.hasOwnProperty(r)&&e[r]instanceof f.GeoPoint&&(++t,t>1))throw Error("There can only be 1 GeoPoint when mutating an object.");e.hasOwnProperty("objectId")&&(d("Ignoring reserved field: objectId"),delete e.objectId),e.hasOwnProperty("className")&&(d("Ignoring reserved field: className"),delete e.className),e.hasOwnProperty("createdAt")&&(d("Ignoring reserved field: createdAt"),delete e.createdAt),e.hasOwnProperty("updatedAt")&&(d("Ignoring reserved field: updatedAt"),delete e.updatedAt)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("./Delta"),u=e("./Id"),c=e("./MutationBatch"),f=e("./StubParse"),l=e("./UpdateChannel"),d=e("./warning"),h=function(){function e(t,n,i){r(this,e),this.action=t,this.target=n,this.data=i}return a(e,[{key:"dispatch",value:function(e){return"NOOP"===this.action?f.Promise.as({}):l.issueMutation(this,e||{})}},{key:"applyTo",value:function(e){var t=this;switch(this.action){case"SET":for(var r in this.data)e[r]=this.data[r];break;case"UNSET":delete e[this.data];break;case"INCREMENT":isNaN(e[this.data.column])?e[this.data.column]=this.data.delta:e[this.data.column]+=this.data.delta;break;case"ADD":e[this.data.column]=Array.isArray(e[this.data.column])?e[this.data.column].concat(this.data.value):this.data.value.concat([]);break;case"ADDUNIQUE":Array.isArray(e[this.data.column])?this.data.value.map(function(r){e[t.data.column].indexOf(r)<0&&e[t.data.column].push(r)}):e[this.data.column]=this.data.value.concat([]);break;case"REMOVE":if(!Array.isArray(e[this.data.column])||e[this.data.column].length<1)break;this.data.value.map(function(r){var n=e[t.data.column].indexOf(r);n>-1&&e[t.data.column].splice(n,1)})}}},{key:"generateDelta",value:function(e){if("DESTROY"===this.action&&this.target instanceof u)return new o(this.target,{},{destroy:!0});var t={};"UNSET"===this.action&&(t[this.data]={unset:!0});var r,n;if(n=this.target instanceof u?this.target:new u(this.target,e.objectId),"CREATE"===this.action||"SET"===this.action)for(r in this.data)t[r]={set:this.data[r]};for(r in e)"objectId"!==r&&(t[r]={set:e[r]}),"createdAt"===r&&(t.updatedAt={set:new Date(e.createdAt)});return new o(n,t)}}]),e}();t.exports={Mutation:h,Batch:c,Create:function(e,t){return t=t||{},s(t),new h("CREATE",e,t)},Destroy:function(e){return new h("DESTROY",n(e),null)},Set:function(e,t){return t&&Object.keys(t).length?(s(t),new h("SET",n(e),t)):(d("Performing a Set mutation with no changes: dispatching thiswill do nothing."),new h("NOOP","",{}))},Unset:function(e,t){return i(t),new h("UNSET",n(e),t)},Increment:function(e,t,r){if(i(t),"undefined"!=typeof r&&isNaN(r))throw new TypeError("Cannot increment by a non-numeric amount");var s={column:t,delta:"undefined"==typeof r?1:r};return new h("INCREMENT",n(e),s)},Add:function(e,t,r){i(t);var s={column:t,value:Array.isArray(r)?r:[r]};return new h("ADD",n(e),s)},AddUnique:function(e,t,r){i(t);var s={column:t,value:Array.isArray(r)?r:[r]};return new h("ADDUNIQUE",n(e),s)},Remove:function(e,t,r){i(t);var s={column:t,value:Array.isArray(r)?r:[r]};return new h("REMOVE",n(e),s)},AddRelation:function(e,t,r){i(t);var s=Array.isArray(r)?r:[r],a={column:t,targets:s.map(n)};return new h("ADDRELATION",n(e),a)},RemoveRelation:function(e,t,r){i(t);var s=Array.isArray(r)?r:[r],a={column:t,targets:s.map(n)};return new h("REMOVERELATION",n(e),a)}}},{"./Delta":3,"./Id":4,"./MutationBatch":8,"./StubParse":14,"./UpdateChannel":17,"./warning":20}],8:[function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=e("./StubParse"),s=function(){function e(){r(this,e),this._aborted=!1,this._dispatched=!1,this._requests=[],this._promises=[]}return n(e,[{key:"getNumberOfRequests",value:function(){return this._requests.length}},{key:"addRequest",value:function(t){if(this._aborted||this._dispatched)throw new Error("Cannot add a request to aborted or dispatched batch.");if(this.getNumberOfRequests()===e.maxBatchSize)throw new Error("Cannot batch more than "+e.maxBatchSize+" requests at a time.");var r=new i.Promise;return this._requests.push(t),this._promises.push(r),r}},{key:"dispatch",value:function(){var e=this;if(this._aborted||this._dispatched)throw new Error("Cannot dispatch an already dispatched or aborted batch.");this._dispatched=!0;var t=this._requests.map(function(e){var t={method:e.method,path:"/1/"+e.path};return e.data&&(t.body=e.data),t});return i._request("POST","batch",{requests:t},{}).then(function(t){e._requests.forEach(function(r,n){var i=t[n],s=e._promises[n];i.success?s.resolve(i.success):i.error&&s.reject(i.error)})},function(t){return e._promises.forEach(function(e){return e.reject(t)}),i.Promise.error(t)})}},{key:"abort",value:function(){this._aborted=!0;var e=new Error("Batch was aborted.");this._promises.forEach(function(t){return t.reject(e)})}}]),e}();s.maxBatchSize=50,t.exports=s},{"./StubParse":14}],9:[function(e,t,r){(function(n){"use strict";function i(e,t){if(t||(t=[]),t.indexOf(e)>-1)throw new Error("Tried to encode circular reference");if(Array.isArray(e))return t=t.concat([e]),e.map(function(e){return i(e,t)});if("[object Date]"===c.call(e))return{__type:"Date",iso:e.toJSON()};if(e instanceof o||e instanceof u.Object){var r=e instanceof o?e.objectId:e.id;if("undefined"==typeof r)throw new Error("Tried to save a pointer to an unsaved Parse Object");return{__type:"Pointer",className:e.className,objectId:r}}if(e instanceof u.GeoPoint||e instanceof u.ACL)return e.toJSON();if(e instanceof u.File){if(!e.url())throw new Error("Tried to save a reference to an unsaved file");return{__type:"File",name:e.name(),url:e.url()}}if(null!=e&&"object"==typeof e){if(e.objectId&&e.className)return{__type:"Pointer",className:e.className,objectId:e.objectId};t=t.concat(e);var n={};for(var s in e)n[s]=i(e[s],t);return n}return e}function s(e){return u._request(e.method,e.path,e.data).then(function(e){return e.createdAt&&(e.createdAt=new Date(e.createdAt)),e.updatedAt&&(e.updatedAt=new Date(e.updatedAt)),u.Promise.as(e)})}function a(e,t){var r,n=e.target,a=e.data,o="string"==typeof n?n:n.className,u="string"==typeof n?"":n.objectId,c=t?t.addRequest.bind(t):s;switch(e.action){case"CREATE":return c({method:"POST",path:"classes/"+o,data:i(a)});case"DESTROY":return c({method:"DELETE",path:"classes/"+o+"/"+u});case"SET":return c({method:"PUT",path:"classes/"+o+"/"+u,data:i(a)});case"UNSET":return r={},r[a]={__op:"Delete"},c({method:"PUT",path:"classes/"+o+"/"+u,data:r});case"INCREMENT":return r={},r[a.column]={__op:"Increment",amount:a.delta},c({method:"PUT",path:"classes/"+o+"/"+u,data:r});case"ADD":return r={},r[a.column]={__op:"Add",objects:i(a.value)},c({method:"PUT",path:"classes/"+o+"/"+u,data:r});case"ADDUNIQUE":return r={},r[a.column]={__op:"AddUnique",objects:i(a.value)},c({method:"PUT",path:"classes/"+o+"/"+u,data:r});case"REMOVE":return r={},r[a.column]={__op:"Remove",objects:i(a.value)},c({method:"PUT",path:"classes/"+o+"/"+u,data:r});case"ADDRELATION":return r={},r[a.column]={__op:"AddRelation",objects:i(a.targets)},c({method:"PUT",path:"classes/"+o+"/"+u,data:r});case"REMOVERELATION":return r={},r[a.column]={__op:"RemoveRelation",objects:i(a.targets)},c({method:"PUT",path:"classes/"+o+"/"+u,data:r})}throw new TypeError("Invalid Mutation action: "+e.action)}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./Id"),u=e("./StubParse"),c=Object.prototype.toString;t.exports.execute=a}).call(this,e("_process"))},{"./Id":4,"./StubParse":14,_process:2}],10:[function(e,t,r){(function(n){"use strict";function i(e){if(!(e.id instanceof g))throw new Error("Cannot store an object without an Id");var t={};return _[e.id]&&(t=_[e.id].queries),_[e.id]={data:e,queries:t},e.id}function s(e){if(!(e instanceof g))throw new TypeError("Argument must be a valid object Id");if(!_[e])return[];var t=Object.keys(_[e].queries);return delete _[e],t}function a(e,t){if(_[e])_[e].queries[t]=!0;else if(w[e])w[e][t]=!0;else{var r={};r[t]=!0,w[e]=r}}function o(e,t){_[e]?delete _[e].queries[t]:w[e]&&(delete w[e][t],Object.keys(w[e]).length<1&&delete w[e])}function u(e){return _[e]?Object.keys(_[e].queries):w[e]?Object.keys(w[e]):[]}function c(e,t,r){var n=E++,i={payloadId:n,date:r||new Date,mutation:t};return O[e]?O[e].push(i):O[e]=[i],n}function f(e){O[e]=[]}function l(e,t,r){var n,i=O[e];for(n=0;n<i.length;n++)if(i[n].payloadId===t){delete i[n].mutation,i[n].delta=r;break}if(n>=i.length)throw new Error("Optimistic Mutation completed, but was not found in the pending stack.");var s=Object.keys(r.map);if(n+1<i.length){var a=i[n+1].delta;"undefined"!=typeof a&&(r.merge(a),i.splice(n+1,1))}if(n>0){var o=i[n-1].delta;"undefined"!=typeof o&&(o.merge(r),i.splice(n,1))}var u=i[0].delta;if(u){i.shift();var c=d(u);return c.id=e,c}return{id:e,latest:v(r.id),fields:s}}function d(e){var t=e.id;if(e.destroy&&_[t])return delete _[t],{id:t,latest:null};var r,n={},i=_[t]&&_[t].data,s=[];if(i)for(r in i)n[r]=i[r];else n.id=t,n.objectId=t.objectId,n.className=t.className,s.push("objectId");for(r in e.map){s.push(r);var a=e.map[r];a.hasOwnProperty("unset")?delete n[r]:a.hasOwnProperty("set")&&(n[r]=a.set)}return i?_[t].data=n:_[t]={data:n,queries:{}},{id:t,latest:n,fields:s}}function h(e,t){var r=m(t);Array.isArray(e)||(e=[e]);var n,s;if(t._order)for(s={},n=0;n<t._order.length;n++){var o=t._order[n];"-"===o[0]&&(o=o.substring(1)),s[o]=!0}var u=[];if(t._include.length)for(n=0;n<t._include.length;n++)u.push(t._include[n].split("."));var c=[];for(n=0;n<e.length;n++){var f=y(e[n]),l=i(f);if(u.length)for(var d=0;d<u.length;d++)for(var h=u[d],p=e[n],b=0;p&&b<h.length;b++)p=p.get(h[b]),p&&i(y(p));var v=l;if(s){var g={};for(var _ in s)g[_]=f[_];v={id:l,ordering:g}}c.push(v),a(f.id,r)}return c}function p(e){Array.isArray(e)||(e=[e]);for(var t=[],r=0;r<e.length;r++){var n=v(e[r]),i={};for(var s in n)i[s]=n[s];Object.freeze(i),t.push(i)}return t}function b(e,t){if(!_[e])return null;"undefined"==typeof t&&(t=[e.toString()]);var r=_[e].data,n={},i=[];for(var s in r){var a=r[s];if(a&&"object"==typeof a&&"Pointer"===a.__type){var o=new g(a.className,a.objectId);t.indexOf(o.toString())<0&&_[o]&&(i=i.concat([o.toString()]),a=b(o,t.concat(i)))}n[s]=a}return n}function v(e){if(O[e]&&O[e].length>0){var t,r,n={};if("CREATE"===O[e][0].mutation.action){t=O[e][0].mutation;var i=t.data;for(r in i)n[r]=i[r];var s=t.target instanceof g?t.target.className:t.target;return n.id=e instanceof g?e:new g(s,e),n.className=s,n.createdAt=n.updatedAt=O[e][0].date,n}if(_[e]){var a=b(e);for(r in a)n[r]=a[r]}for(var o=0;o<O[e].length;o++){if(t=O[e][o].mutation,"DESTROY"===t.action)return null;t.applyTo(n),n.updatedAt=O[e][o].date}return n}return _[e]?b(e):null}Object.defineProperty(r,"__esModule",{value:!0});var y=e("./flatten"),g=e("./Id"),m=e("./QueryTools").queryHash,_={},w={},O={},E=0;t.exports.storeObject=i,t.exports.removeObject=s,t.exports.addSubscriber=a,t.exports.removeSubscriber=o,t.exports.fetchSubscribers=u,t.exports.stackMutation=c,t.exports.destroyMutationStack=f,t.exports.resolveMutation=l,t.exports.commitDelta=d,t.exports.storeQueryResults=h,t.exports.getDataForIds=p,t.exports.deepFetch=b,t.exports.getLatest=v}).call(this,e("_process"))},{"./Id":4,"./QueryTools":13,"./flatten":19,_process:2}],11:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e,t,r){for(var n=!0;n;){var i=e,s=t,a=r;n=!1,null===i&&(i=Function.prototype);var o=Object.getOwnPropertyDescriptor(i,s);if(void 0!==o){if("value"in o)return o.value;var u=o.get;return void 0===u?void 0:u.call(a)}var c=Object.getPrototypeOf(i);if(null===c)return void 0;e=c,t=s,r=a,n=!0,o=c=void 0}},o=e("./StubParse"),u=(e("./ParsePatches"),e("./warning"));r["default"]=function(e){return function(e){function t(){n(this,t);for(var e=arguments.length,r=Array(e),i=0;e>i;i++)r[i]=arguments[i];if(a(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,r),this._subscriptions={},this.data={},this._pendingQueries={},this._queryErrors={},!this.observe)throw new Error("Components extending ParseComponent must declare an observe() method.")}return i(t,e),s(t,[{key:"componentWillMount",value:function(){this._subscribe(this.props,this.state)}},{key:"componentWillUnmount",value:function(){this._unsubscribe()}},{key:"componentWillUpdate",value:function(e,t){(e!==this.props||t!==this.state)&&this._subscribe(e,t)}},{key:"pendingQueries",value:function(){var e=[];for(var t in this._subscriptions)this._subscriptions[t].pending&&this._subscriptions[t].pending()&&e.push(t);return e}},{key:"queryErrors",value:function(){if(Object.keys(this._queryErrors).length<1)return null;var e={};for(var t in this._queryErrors)e[t]=this._queryErrors[t];return e}},{key:"refreshQueries",value:function(e){var t,r={};if("undefined"==typeof e)for(t in this._subscriptions)r[t]=this._subscriptions[t];else if("string"==typeof e)this._subscriptions[e]?r[e]=this._subscriptions[e]:u("Cannot refresh unknown query name: "+e);else{if(!Array.isArray(e))throw new TypeError("refreshQueries must receive a query name or an array of query names");for(var n=0;n<e.length;n++)this._subscriptions[e[n]]?r[e[n]]=this._subscriptions[e[n]]:u("Cannot refresh unknown query name: "+e[n])}for(t in r)this._pendingQueries[t]=!0,r[t].refresh();this.forceUpdate()}},{key:"_subscribe",value:function(e,t){var r=this.observe(e,t),n={};for(var i in r)r[i].subscribe?(n[i]=r[i].subscribe({onNext:this._receiveData.bind(this,i),onError:r[i]instanceof o.Query?this._receiveError.bind(this,i):function(){}}),this._pendingQueries[i]=!0):u('The observation value "'+i+'" is not subscribable. Make sure you are returning the Query, and not fetching it yourself.');this._unsubscribe(),this._subscriptions=n}},{key:"_unsubscribe",value:function(){for(var e in this._subscriptions)this._subscriptions[e].dispose();this._subscriptions={}}},{key:"_receiveData",value:function(e,t){this.data[e]=t,delete this._pendingQueries[e],delete this._queryErrors[e],this.forceUpdate()}},{key:"_receiveError",value:function(e,t){this._queryErrors[e]=t,this.forceUpdate()}}]),t}(e.Component)},t.exports=r["default"]},{"./ParsePatches":12,"./StubParse":14,"./warning":20}],12:[function(e,t){"use strict";var r=e("./flatten"),n=e("./Id"),i=e("./LocalSubscriptions"),s=e("./StubParse"),a=e("./SubscriptionManager"),o=s.User.prototype.signUp,u=s.User.prototype.logIn,c=s.User.prototype._linkWith,f=s.User.logOut,l={toPlainObject:function(){return r(this)},subscribe:function(e){return a.subscribeToQuery(this,e)},observeOne:function(e){return this._observeOne=!0,this.equalTo("objectId",e).limit(1)},signUp:function(e,t){return o.call(this,e,t).then(function(){i.currentUser.update()})},logIn:function(e){return u.call(this,e).then(function(){i.currentUser.update()})},_linkWith:function(e,t){return c.call(this,e,t).then(function(){i.currentUser.update()})},logOut:function(){var e=f();return i.currentUser.update(),e}},d=["equalTo","notEqualTo","containedIn","notContainedIn"],h={applyPatches:function(){s.Object.prototype.toPlainObject||(s.Object.prototype.toPlainObject=l.toPlainObject),s.Query.prototype.subscribe||(s.Query.prototype.subscribe=l.subscribe),s.Query.prototype.observeOne||(s.Query.prototype.observeOne=l.observeOne),d.forEach(function(e){var t=s.Query.prototype[e];s.Query.prototype[e]=function(e,r){var i=r;return Array.isArray(r)?i=r.map(function(e){return e&&e.id&&e.id instanceof n?{__type:"Pointer",className:e.id.className,objectId:e.id.objectId}:e}):r&&r.id&&r.id instanceof n&&(i={__type:"Pointer",className:r.id.className,objectId:r.id.objectId}),t.call(this,e,i)}}),s.User.prototype.signUp=l.signUp,s.User.prototype.logIn=l.logIn,s.User.prototype._linkWith=l._linkWith,s.User.logOut=l.logOut}};t.exports=h},{"./Id":4,"./LocalSubscriptions":5,"./StubParse":14,"./SubscriptionManager":16,"./flatten":19}],13:[function(e,t){(function(r){"use strict";function n(e){if(!e.hasOwnProperty("$or"))return e;for(var t=[],r=0;r<e.$or.length;r++)t=t.concat(e.$or[r]);return t}function i(e){if("object"!=typeof e||null===e)return"string"==typeof e?'"'+e.replace(/\|/g,"%|")+'"':e+"";if(Array.isArray(e)){var t=e.map(i);return t.sort(),"["+t.join(",")+"]"}var r=[],n=Object.keys(e);n.sort();for(var s=0;s<n.length;s++)r.push(i(n[s])+":"+i(e[n[s]]));return"{"+r.join(",")+"}"}function s(e){if(!(e instanceof l.Query))throw new TypeError("Only a Parse Query can be hashed");var t,r=n(e._where||{}),s=[],a=[];if(Array.isArray(r)){var o={};for(t=0;t<r.length;t++){var u={},c=Object.keys(r[t]);c.sort();for(var f=0;f<c.length;f++)u[c[f]]=r[t][c[f]],o[c[f]]=!0;a.push(u)}s=Object.keys(o),s.sort()}else for(s=Object.keys(r),s.sort(),t=0;t<s.length;t++)a.push(r[s[t]]);var d=[s.join(","),i(a),i(e._include||[]),i(e._order||[]),e._limit,e._skip];return e.className+":"+d.join("|")}function a(e){var t=e.indexOf(":"),r=e.substring(0,t),n=e.indexOf("|"),i=e.substring(t+1,n),s=i.split(",");return{className:r,keys:s.length?s:[""]}}function o(e,t){for(var r=!0;r;){var n=e,i=t;r=!1;{if(!(i instanceof l.Query)){for(var s in i)if(!u(n,s,i[s]))return!1;return!0}var a=n.id instanceof f?n.id.className:n.className;if(a!==i.className)return!1;e=n,t=i._where,r=!0,a=void 0}}}function u(e,t,r){var n;if("$or"===t){for(n=0;n<r.length;n++)if(o(e,r[n]))return!0;return!1}if("$relatedTo"===t)return!1;if("object"!=typeof r)return Array.isArray(e[t])?e[t].indexOf(r)>-1:e[t]===r;var i;if(r.__type){if("Pointer"===r.__type){var s=e[t].objectId||e[t].id;return r.className===e[t].className&&r.objectId===s}if(i=l._decode(t,r),Array.isArray(e[t])){for(n=0;n<e[t].length;n++)if(c(e[t][n],i))return!0;return!1}return c(e[t],i)}for(var a in r)switch(i=r[a],i.__type&&(i=l._decode(t,i)),a){case"$lt":if(e[t]>=i)return!1;break;case"$lte":if(e[t]>i)return!1;break;case"$gt":if(e[t]<=i)return!1;break;case"$gte":if(e[t]<i)return!1;break;case"$ne":if(c(e[t],i))return!1;break;case"$in":if(i.indexOf(e[t])<0)return!1;break;case"$nin":if(i.indexOf(e[t])>-1)return!1;break;case"$all":for(n=0;n<i.length;n++)if(e[t].indexOf(i[n])<0)return!1;break;case"$exists":if("undefined"==typeof e[t])return!1;break;case"$regex":if("object"==typeof i)return i.test(e[t]);for(var u="",f=-2,d=i.indexOf("\\Q");d>-1;)u+=i.substring(f+2,d),f=i.indexOf("\\E",d),f>-1&&(u+=i.substring(d+2,f).replace(/\\\\\\\\E/g,"\\E").replace(/\W/g,"\\$&")),d=i.indexOf("\\Q",f);u+=i.substring(Math.max(d,f+2));var h=new RegExp(u,r.$options||"");if(!h.test(e[t]))return!1;break;case"$nearSphere":var p=i.radiansTo(e[t]),b=r.$maxDistance||1/0;return b>=p;case"$within":var v=i.$box[0],y=i.$box[1];return v.latitude>y.latitude||v.longitude>y.longitude?!1:e[t].latitude>v.latitude&&e[t].latitude<y.latitude&&e[t].longitude>v.longitude&&e[t].longitude<y.longitude;case"$options":break;case"$maxDistance":break;case"$select":return!1;case"$dontSelect":return!1;default:return!1}return!0}var c=e("./equalObjects"),f=e("./Id"),l=e("./StubParse"),d={queryHash:s,keysFromHash:a,matchesQuery:o};t.exports=d}).call(this,e("_process"))},{"./Id":4,"./StubParse":14,"./equalObjects":18,_process:2}],14:[function(e,t){"use strict";if("undefined"==typeof Parse){if("function"!=typeof e)throw new Error("Cannot initialize Parse + React: Parse is not defined.");try{t.exports=e("parse")}catch(r){throw new Error("Failed to require Parse module. You need the Parse SDK installed to use Parse + React")}}else t.exports=Parse},{parse:void 0}],15:[function(e,t,r){(function(n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){return e instanceof u?e:e.id}function a(e,t,r){for(var n=0;n<e.length;n++){var i=e[n],s=1;if("-"===i[0]&&(i=i.substring(1),s=-1),t[i]<r[i])return-1*s;if(t[i]>r[i])return s}return 0}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./Id"),c=e("./ObjectStore"),f=function(){function e(t){i(this,e),this.originalQuery=t,this.pending=!1,this.subscribers={},this.resultSet=[],this.observationCount=0,this.issueQuery()}return o(e,[{key:"addSubscriber",value:function(e){var t="o"+this.observationCount++;this.subscribers[t]=e;var r=this.resultSet.map(s),n=r.length?c.getDataForIds(r):[];return e.onNext(this.originalQuery._observeOne?n[0]:n),t}},{key:"removeSubscriber",value:function(e){return delete this.subscribers[e],Object.keys(this.subscribers).length}},{key:"_forEachSubscriber",value:function(e){for(var t in this.subscribers)e.call(this,this.subscribers[t])}},{key:"issueQuery",value:function(){var e=this;this.pending=!0,this.originalQuery.find().then(function(t){e.pending=!1,e.resultSet=c.storeQueryResults(t,e.originalQuery),e.pushData()},function(t){e.pending=!1,e.pushError(t)})}},{key:"addResult",value:function(e,t){if(this.originalQuery._order){if(this.originalQuery._skip)return;for(var r=0,n=this.originalQuery._order;r<this.resultSet.length;){var i=this.resultSet[r];if(i instanceof u)throw new Error("Encountered result without ordering info.");var s=a(n,e,i.ordering);if(0>=s)break;r++}for(var o={},c=0;c<n.length;c++){var f=n[c];"-"===f[0]&&(f=f.substring(1)),o[f]=e[f]}this.resultSet.splice(r,0,{id:e.id,ordering:o})}else this.resultSet.push(e.id);t||this.pushData()}},{key:"removeResult",value:function(e,t){for(var r=e.toString(),n=0;n<this.resultSet.length;n++){var i=this.resultSet[n];if(i instanceof u||(i=i.id),i.toString()===r)return this.resultSet.splice(n,1),void(t||this.pushData())}}},{key:"pushData",value:function(){var e=this.resultSet;this.originalQuery._limit>-1&&(e=e.slice(0,this.originalQuery._limit));var t=e.map(s),r=c.getDataForIds(t);this.originalQuery._observeOne&&(r=r[0]),this._forEachSubscriber(function(e){return e.onNext(r)})}},{key:"pushError",value:function(e){this._forEachSubscriber(function(t){t.onError&&t.onError(e)})}}]),e}();t.exports=f}).call(this,e("_process"))},{"./Id":4,"./ObjectStore":10,_process:2}],16:[function(e,t){(function(r){"use strict";function n(e,t){var r=d(e),n=p[r];n||(n=new h(e),p[r]=n,a(e,r));var s=n.addSubscriber(t);return{refresh:function(){n.pending||n.issueQuery()},pending:function(){return n.pending},dispose:function(){i(n,r,s)}}}function i(e,t,r){if(e.removeSubscriber(r)<1){var n,i=e.resultSet;for(n=0;n<i.length;n++){var s=i[n];s instanceof u||(s=s.id),c.removeSubscriber(s,t)}delete p[t];var a=l(t),o=b[a.className];if(!o)return;for(n=0;n<a.keys.length;n++)delete o[a.keys[n]][t]}}function s(e){return p[e]||null}function a(e,t){var r=l(t).keys;r.length<1&&(r=[""]);var n=b[e.className];n||(n=b[e.className]={});for(var i=0;i<r.length;i++)n[r[i]]||(n[r[i]]={}),n[r[i]][t]=!0}function o(e,t){var r=b[e];if(!r)return[];var n={};t=t.concat("");for(var i=0;i<t.length;i++)if(r[t[i]])for(var s in r[t[i]])n[s]=!0;return Object.keys(n)}var u=e("./Id"),c=e("./ObjectStore"),f=e("./QueryTools"),l=f.keysFromHash,d=f.queryHash,h=e("./Subscription"),p={},b={},v={subscribeToQuery:n,getSubscription:s,queriesForFields:o};t.exports=v}).call(this,e("_process"))},{"./Id":4,"./ObjectStore":10,"./QueryTools":13,"./Subscription":15,_process:2}],17:[function(e,t,r){"use strict";function n(e,t){var r=e.target instanceof o?e.target:new o(e.target,"local-"+p++);return t.waitForServer?c.execute(e,t.batch).then(function(t){var n=f.fetchSubscribers(r),i=e.generateDelta(t),a=f.commitDelta(i);return s(n,a)}):i(r,e,t.batch)}function i(e,t,r){var n=f.stackMutation(e,t),i=[];"CREATE"!==t.action&&(i=f.fetchSubscribers(e));var o=null;"DESTROY"!==t.action&&(o=f.getLatest(e));var u={id:e,latest:o,fields:o?Object.keys(o):[]};s(i,u);var d=new l.Promise;return c.execute(t,r).then(function(r){var i=f.fetchSubscribers(e),a=t.generateDelta(r),o=f.resolveMutation(e,n,a);d.resolve(s(i,o))},function(r){var i=f.fetchSubscribers(e);if("CREATE"===t.action)i.forEach(function(t){var r=h.getSubscription(t);r.removeResult(e)}),f.destroyMutationStack(e);else{var o=new a(e,{}),u=f.resolveMutation(e,n,o);s(i,u)}d.reject(r)}),d}function s(e,t){if(null===t.latest)return e.forEach(function(e){var r=h.getSubscription(e);if(!r)throw new Error("Object is attached to a nonexistent subscription");r.removeResult(t.id)}),null;var r={};if(e.forEach(function(e){r[e]=!0;var n=h.getSubscription(e);d.matchesQuery(t.latest,n.originalQuery)?t.id.toString()!==t.latest.id.toString()?(n.removeResult(t.id,!0),f.removeSubscriber(t.id,e),n.addResult(t.latest),f.addSubscriber(t.latest.id,e)):n.pushData():(n.removeResult(t.id),f.removeSubscriber(t.id,e))
}),h.queriesForFields(t.latest.id.className,t.fields).forEach(function(e){if(!r[e]){var n=h.getSubscription(e);d.matchesQuery(t.latest,n.originalQuery)&&(n.addResult(t.latest),f.addSubscriber(t.latest.id,e))}}),"_User"===t.latest.id.className){var n=l.User.current();n&&t.latest.id.objectId===n.id&&u.currentUser.update(t.latest)}return t.latest}Object.defineProperty(r,"__esModule",{value:!0}),r.issueMutation=n;var a=e("./Delta"),o=e("./Id"),u=e("./LocalSubscriptions"),c=e("./MutationExecutor"),f=e("./ObjectStore"),l=e("./StubParse"),d=e("./QueryTools"),h=e("./SubscriptionManager"),p=0},{"./Delta":3,"./Id":4,"./LocalSubscriptions":5,"./MutationExecutor":9,"./ObjectStore":10,"./QueryTools":13,"./StubParse":14,"./SubscriptionManager":16}],18:[function(e,t){"use strict";function r(e,t){if(typeof e!=typeof t)return!1;if("object"!=typeof e)return e===t;if(e===t)return!0;if("[object Date]"===n.call(e))return"[object Date]"===n.call(t)?+e===+t:!1;if(Array.isArray(e)){if(Array.isArray(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1;return!0}return!1}if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var s in e)if(!r(e[s],t[s]))return!1;return!0}var n=Object.prototype.toString;t.exports=r},{}],19:[function(e,t){"use strict";function r(e){return e instanceof s.Object?{__type:"Pointer",className:e.className,objectId:e.id}:n(e)}function n(e){if(Array.isArray(e))return e.map(r);if(!(e instanceof s.Object))return a("Attempted to flatten something that is not a Parse Object"),e;var t={id:new i(e.className,e.id),className:e.className,objectId:e.id};e.createdAt&&(t.createdAt=e.createdAt),e.updatedAt&&(t.updatedAt=e.updatedAt);for(var n in e.attributes){var o=e.attributes[n];t[n]=o instanceof s.Object?r(o):Array.isArray(o)?o.map(r):o}return t}var i=e("./Id"),s=e("./StubParse"),a=e("./warning");t.exports=n},{"./Id":4,"./StubParse":14,"./warning":20}],20:[function(e,t){"use strict";try{t.exports=function(){}}catch(r){t.exports=function(){}}},{}]},{},[1])(1)});
